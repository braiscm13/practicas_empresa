SELECT DISTINCT 
	CDFICHEROS_CONTRATO.IDFICHERO, 
	CDFICHEROS_CONTRATO.CG_CONTRATO, 
	CDFICHEROS_REGISTRO.MAIL, 
	CDFICHEROS_REGISTRO.ANALIZAR, 
	CDFICHEROS.IDORIGEN, 
	CDFICHEROS.F_DESCARGA_DATOS, 
	CDFICHEROS.TIPO, 
	CDFICHEROS.NOMB_PROCESADO, 
	CDFICHEROS_REGISTRO.NOTIF_URL, 
	CDFICHEROS_REGISTRO.ISMOVIL,
	'N' as PROCESADO
FROM 
	CDFICHEROS_CONTRATO, 
	CDFICHEROS_REGISTRO, 
	CDFICHEROS
WHERE 
	CDFICHEROS_CONTRATO.IDFICHERO     = CDFICHEROS_REGISTRO.IDFICHERO
	AND CDFICHEROS_CONTRATO.CG_CONTRATO = CDFICHEROS_REGISTRO.CG_CONTRATO
	AND CDFICHEROS.IDFICHERO            = CDFICHEROS_CONTRATO.IDFICHERO
	and CDFICHEROS_REGISTRO.num = (select max(num) from CDFICHEROS_REGISTRO where idfichero = ? )
	AND CDFICHEROS_CONTRATO.IDFICHERO = ?
	%OVERWRITE%	